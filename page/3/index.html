<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Helianthus&#039;s Blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="helianthus&#039;s blog"><meta name="msapplication-TileImage" content="./img/avatar.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="helianthus&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="Helianthus&#039;s Blog"><meta property="og:url" content="https://love1angel.github.io/"><meta property="og:site_name" content="Helianthus&#039;s Blog"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://love1angel.github.io/img/og_image.png"><meta property="article:author" content="Helianthus"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://love1angel.github.io/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://love1angel.github.io"},"headline":"Helianthus's Blog","image":["https://love1angel.github.io/img/og_image.png"],"author":{"@type":"Person","name":"Helianthus"},"publisher":{"@type":"Organization","name":"Helianthus's Blog","logo":{"@type":"ImageObject","url":"https://love1angel.github.io/img/avatar.svg"}},"description":""}</script><link rel="icon" href="/./img/avatar.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.2.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/./img/avatar.svg" alt="Helianthus&#039;s Blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a><a class="navbar-item" href="/org">Org</a></div><div class="navbar-end"><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-20T13:50:08.000Z" title="8/20/2022, 9:50:08 PM">2022-08-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.091Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item"><a class="link-muted" href="/categories/languages/">languages</a><span> / </span><a class="link-muted" href="/categories/languages/cpp/">cpp</a><span> / </span><a class="link-muted" href="/categories/languages/cpp/tools/">tools</a></span><span class="level-item">a few seconds read (About 0 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/20/languages/cpp/tools/clang-tidy/">clang-tidy</a></p><div class="content"></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-20T13:50:01.000Z" title="8/20/2022, 9:50:01 PM">2022-08-20</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.091Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item"><a class="link-muted" href="/categories/languages/">languages</a><span> / </span><a class="link-muted" href="/categories/languages/cpp/">cpp</a><span> / </span><a class="link-muted" href="/categories/languages/cpp/tools/">tools</a></span><span class="level-item">a few seconds read (About 80 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/20/languages/cpp/tools/clang-format/">clang-format tool usage</a></p><div class="content"><p>clang-format tools cheat sheet, this tool aim at</p>
<ul>
<li>keep code style consistent</li>
<li>auto check and format code</li>
</ul></div><a class="article-more button is-small is-size-7" href="/2022/08/20/languages/cpp/tools/clang-format/#more">Read more</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-08-01T09:21:42.000Z" title="8/1/2022, 5:21:42 PM">2022-08-01</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.088Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item">a few seconds read (About 25 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/08/01/book/reReadClassicBook/">reReadClassicBook</a></p><div class="content"><p>i will read classic book from this month.</p>
<ul>
<li><p>soft skill<br>[] The Pragmatic Programmer: From Journeyman to Master</p>
</li>
<li><p>the C programming language<br>[] the C programming language<br>[]</p>
</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-05-11T09:16:51.000Z" title="5/11/2022, 5:16:51 PM">2022-05-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.089Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item"><a class="link-muted" href="/categories/gdb/">gdb</a></span><span class="level-item">4 minutes read (About 577 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/05/11/gdb/gdb/">gdb</a></p><div class="content"><p>gdb cheatsheet</p></div><a class="article-more button is-small is-size-7" href="/2022/05/11/gdb/gdb/#more">Read more</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-04-13T06:09:27.000Z" title="4/13/2022, 2:09:27 PM">2022-04-13</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.091Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item"><a class="link-muted" href="/categories/languages/">languages</a><span> / </span><a class="link-muted" href="/categories/languages/cpp/">cpp</a><span> / </span><a class="link-muted" href="/categories/languages/cpp/tools/">tools</a></span><span class="level-item">a few seconds read (About 79 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/04/13/languages/cpp/tools/CMake/">CMake</a></p><div class="content"><p>cmake cheatsheet</p></div><a class="article-more button is-small is-size-7" href="/2022/04/13/languages/cpp/tools/CMake/#more">Read more</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-04-11T08:49:46.000Z" title="4/11/2022, 4:49:46 PM">2022-04-11</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.091Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item">3 minutes read (About 400 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/04/11/languages/cpp/tools/GTest/">GTest</a></p><div class="content"><h1 id="example"><a href="#example" class="headerlink" title="example"></a>example</h1><p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/module/FetchContent.html">https://cmake.org/cmake/help/latest/module/FetchContent.html</a></p>
<p><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/git-stage/module/GoogleTest.html">https://cmake.org/cmake/help/git-stage/module/GoogleTest.html</a></p>
<p>xUnit architecture<br><a target="_blank" rel="noopener" href="http://www.istqb.org/">International Software Testing Qualifications Board</a></p>
<p>ctest 是 命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cmake -S . -B build</span><br><span class="line">$ cmake --build build</span><br><span class="line">$ cd build &amp;&amp; ctest</span><br></pre></td></tr></table></figure>

<ol>
<li>Test</li>
</ol>
<p>Google 以前用来代表 test case 的术语</p>
<ol start="2">
<li>Test Case</li>
</ol>
<p>TEST() 代表 test case, Exercise a particular program path with specific input values and verify the results</p>
<ol start="3">
<li>Test Suite</li>
</ol>
<p>Google 以前吧关联的测试用例叫 test case, 现在逐步采用 suite API refactor，deprecate 老的 API，A test suite contains one or many tests.</p>
<h1 id="assertion-三种结果，成功，非致命性错误-nonfatal-failure-，致命性错误-fatal-failure-，本质是函数"><a href="#assertion-三种结果，成功，非致命性错误-nonfatal-failure-，致命性错误-fatal-failure-，本质是函数" class="headerlink" title="assertion 三种结果，成功，非致命性错误(nonfatal failure)，致命性错误(fatal failure)，本质是函数"></a>assertion 三种结果，成功，非致命性错误(nonfatal failure)，致命性错误(fatal failure)，本质是函数</h1><p>测试崩溃或 expect 错误会失败</p>
<p>ASSERT_* 会产生致命性错误，中止当前的函数往下走，EXPECT_* 则不会产生致命性错误，还会继续走，一般使用 expect 来发现更多错误，没有意义往下走使用 assert</p>
<p>assert 会直接返回，所以不执行 clean-up 代码，会导致泄漏，如果发生 heap check error 的时候，要考虑是否是 assert 导致的<br>Since a failed ASSERT_* returns from the current function immediately, possibly skipping clean-up code that comes after it, it may cause a space leak. Depending on the nature of the leak, it may or may not be worth fixing - so keep this in mind if you get a heap checker error in addition to assertion errors.</p>
<p>自定义 log ostream，会被自动转为 UTF-8 编码</p>
<p>ASSERT_EQ(x.size(), y.size()) &lt;&lt; “Vectors x and y are of unequal length”;</p>
<p>TEST(TestSuiteName, TestName) {<br>  … test body …<br>}<br>有问题就会失败</p>
<p>测试全名是 suite + test，两个名字不应该加下划线，全名是 identifier，相同的第一个名字应该相同</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-04-06T02:47:33.000Z" title="4/6/2022, 10:47:33 AM">2022-04-06</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.089Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item"><a class="link-muted" href="/categories/ethernet/">ethernet</a><span> / </span><a class="link-muted" href="/categories/ethernet/some-ip/">some/ip</a></span><span class="level-item">5 minutes read (About 734 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/04/06/ethernet/some-ip/capi/">capi</a></p><div class="content"><p>本文主要介绍车载以太网的 CommonAPI 的应用</p></div><a class="article-more button is-small is-size-7" href="/2022/04/06/ethernet/some-ip/capi/#more">Read more</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-03-21T05:58:03.000Z" title="3/21/2022, 1:58:03 PM">2022-03-21</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.093Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item"><a class="link-muted" href="/categories/tools/">tools</a></span><span class="level-item">10 minutes read (About 1430 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/21/tools/git/">git</a></p><div class="content"><p>本文主要记录 git 使用。submodule</p></div><a class="article-more button is-small is-size-7" href="/2022/03/21/tools/git/#more">Read more</a></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-03-19T03:44:08.000Z" title="3/19/2022, 11:44:08 AM">2022-03-19</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.093Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item">8 minutes read (About 1205 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/19/tools/Markdown/">Markdown</a></p><div class="content"><h1 id="What-is-Markdown"><a href="#What-is-Markdown" class="headerlink" title="What is Markdown?"></a>What is Markdown?</h1><p>Markdown 是一种轻量级的文本标记写法（markup language），广泛用于 GitHub，博客等各种 Web 网站。<a target="_blank" rel="noopener" href="https://www.markdownguide.org/">Markdown guide</a> 网站源码：<a target="_blank" rel="noopener" href="https://github.com/mattcone/markdown-guide">GitHub</a>，网站教程已经写的很好，本文借鉴于此，做个笔记</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p>处理 markdown 文件的应用程序使用一种称为 Markdown 处理器，也叫解析器或者实现的东西将该格式文件转换为 HTML, 再通过 Web 浏览器进行显示</p>
<h1 id="Why-use-Markdown"><a href="#Why-use-Markdown" class="headerlink" title="Why use Markdown?"></a>Why use Markdown?</h1><ol>
<li><p>easy to learn, use, light-weight</p>
</li>
<li><p>place emphasis on content, not mark format</p>
</li>
<li><p>can be transfer into html or other format, easy for distribution</p>
</li>
<li><p>微软的 word 等软件太生草了，写的时候纠结于格式，打开还要下载特定的软件，不适合到处纷发这种特性，<strong>Markdown 注重的是写作的内容而不是格式问题</strong></p>
</li>
<li><p>Markdown 可以内嵌 HTML 语法，许多网站内嵌 Markdown 处理器，适合现在 Web 浏览器显示</p>
</li>
</ol>
<h2 id="生成-GitHub-Pages"><a href="#生成-GitHub-Pages" class="headerlink" title="生成 GitHub Pages"></a>生成 <a target="_blank" rel="noopener" href="https://docs.github.com/cn">GitHub</a> Pages</h2><p>GitHub 为 Jekyll 提供免费的网页 host 服务</p>
<p><a target="_blank" rel="noopener" href="http://markdown.p2hp.com/tools/github-pages/index.html">GitHub Pages</a> uses <a target="_blank" rel="noopener" href="http://markdown.p2hp.com/tools/jekyll/index.html">Jekyll</a> as the backend for its free website creation service</p>
<p><a target="_blank" rel="noopener" href="https://www.staticgen.com/">其他可用的静态网站生成器</a></p>
<p>如果您想使用内容管理系统（CMS）来为网站提供动力，请查看<a target="_blank" rel="noopener" href="https://ghost.org/">Ghost</a>。这是一个免费的开源博客平台，具有出色的Markdown编辑器。如果您是WordPress用户，您将很高兴知道WordPress.com上托管的网站有<a target="_blank" rel="noopener" href="https://en.support.wordpress.com/markdown/">Markdown支持</a>。自托管的WordPress网站可以使用<a target="_blank" rel="noopener" href="https://jetpack.com/support/markdown/">Jetpack插件</a>。</p>
<h1 id="How-to-use-Markdown"><a href="#How-to-use-Markdown" class="headerlink" title="How to use Markdown?"></a>How to use Markdown?</h1><h2 id="Basic-Syntax"><a href="#Basic-Syntax" class="headerlink" title="Basic Syntax"></a>Basic Syntax</h2><ol>
<li><p>标题</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 标题</span></span><br><span class="line">or</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">段落之间空行，且不要缩进。用 &amp;nbsp;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>粗体</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="strong">**bold**</span></span><br><span class="line">or</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">strong</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">strong</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>斜体</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="emphasis">*italic*</span></span><br><span class="line">or</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">em</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">em</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>块引用</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="quote">&gt; blockquote</span></span><br><span class="line">&gt;&gt; two</span><br><span class="line">之间空行</span><br><span class="line"><span class="quote">&gt; ###</span></span><br><span class="line"><span class="quote">&gt;</span></span><br><span class="line"><span class="quote">&gt; -</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>有序列表</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">1.</span> ordered list</span><br><span class="line"><span class="bullet">2.</span> two</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ol</span>&gt;</span></span></span><br><span class="line"><span class="code">    &lt;li&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">    &lt;li&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">&lt;/ol&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">1968\. 转义</span><br><span class="line"></span><br><span class="line">在列表中通过缩进四个空格来添加其他元素</span><br></pre></td></tr></table></figure>
</li>
<li><p>无序列表</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> unordered list</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="code">    &lt;li&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">    &lt;li&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="code">&lt;/ul&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>code</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">`code`</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">code</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">code</span>&gt;</span></span></span><br><span class="line"><span class="code">``Use `</span>code<span class="code">` in your Markdown file.`</span>`</span><br></pre></td></tr></table></figure>
</li>
<li><p>水平线 horizontal rule</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">之间空行</span><br></pre></td></tr></table></figure>
</li>
<li><p>链接</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">title</span>](<span class="link">link address &quot;悬停提示&quot;</span>)</span><br><span class="line"></span><br><span class="line">直接显示链接</span><br><span class="line"><span class="language-xml">&lt;https://www.markdownguide.org&gt;</span></span><br><span class="line"><span class="language-xml">&lt;fake@example.com&gt;</span></span><br><span class="line"></span><br><span class="line">I love supporting the <span class="strong">**[<span class="string">EFF</span>](<span class="link">https://eff.org</span>)**</span>.</span><br><span class="line">This is the <span class="emphasis">*[<span class="string">Markdown Guide</span>](<span class="link">https://www.markdownguide.org</span>)*</span>.</span><br><span class="line">See the section on [<span class="string">`code`</span>](<span class="link">#code</span>).</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&quot;</span> <span class="attr">title</span>=<span class="string">&quot;&quot;</span>&gt;</span></span>link<span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">与原来的链接一样，1 为 1 的链接</span><br><span class="line">[<span class="string">hobbit-hole</span>][<span class="symbol">1</span>]</span><br><span class="line">[<span class="symbol">1</span>]: <span class="link">https://en.wikipedia.org/wiki/Hobbit#Lifestyle &quot;Hobbit lifestyles&quot;</span></span><br><span class="line">Markdown 中链接如果有空格用%20代替，否则用 HTML 的 tag</span><br></pre></td></tr></table></figure>
</li>
<li><p>图片</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">![<span class="string">alt 不显示的时候</span>](<span class="link">image.jpg &quot;title&quot;</span>)</span><br><span class="line"></span><br><span class="line">[<span class="string">![An old rock in the desert</span>](<span class="link">/assets/images/shiprock.jpg &quot;Shiprock, New Mexico by Beau Rogers&quot;</span>)](<span class="link">https://www.flickr.com/photos/</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<p>块级元素之间分行，尽量不要缩进 tag，会干扰格式，且不能在块级元素使用 Markdown 语法，不会工作</p>
<p>\进行转义</p>
<h2 id="Extended-Syntax"><a href="#Extended-Syntax" class="headerlink" title="Extended Syntax"></a>Extended Syntax</h2><p><a target="_blank" rel="noopener" href="https://github.github.com/gfm/">GitHub Flavored Markdown (GFM)</a></p>
<ol>
<li><p>表格 table</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">| class | name | test |</span><br><span class="line">|:------|:----:|-----:|</span><br><span class="line">| 1     | 2    | \|   |</span><br><span class="line"></span><br><span class="line">| 可以用 &amp;#124; 表中可以用 HTML 语法加入 list</span><br></pre></td></tr></table></figure>
</li>
<li><p>代码块 fenced code block</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">```json</span></span><br><span class="line"><span class="code">&#123;</span></span><br><span class="line"><span class="code">    &quot;firstname&quot;: &quot;John&quot;,</span></span><br><span class="line"><span class="code">    &quot;lastname&quot;: &quot;Smith&quot;,</span></span><br><span class="line"><span class="code">    &quot;age&quot;: 25</span></span><br><span class="line"><span class="code">&#125;</span></span><br><span class="line"><span class="code">\`\`\`</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>脚注 footnote</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">可以添加标识符，但实际上仍然是按顺序标号</span><br><span class="line">Here&#x27;s a simple footnote,[^1] and here&#x27;s a longer one.[^bignote]</span><br><span class="line"></span><br><span class="line">[^1]: This is the first footnote.</span><br><span class="line"></span><br><span class="line">[^bignote]: Here&#x27;s one with multiple paragraphs and code.</span><br><span class="line"></span><br><span class="line">    Indent paragraphs to include them in the footnote.</span><br><span class="line"></span><br><span class="line">    `&#123; my code &#125;`</span><br><span class="line"></span><br><span class="line">    Add as many paragraphs as you like.</span><br></pre></td></tr></table></figure>
</li>
<li><p>标题 ID heading ID</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">### My Great Heading &#123;#custom-id&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">id</span>=<span class="string">&quot;custom-id&quot;</span>&gt;</span></span>My Great Heading<span class="language-xml"><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">[<span class="string">Heading IDs</span>](<span class="link">#heading-ids</span>)</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;#heading-ids&quot;</span>&gt;</span></span>Heading IDs<span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">[<span class="string">Heading IDs</span>](<span class="link">https://www.markdownguide.org/extended-syntax#heading-ids</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>定义列表 definition list</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">term</span><br><span class="line">: definitionFirst Term</span><br><span class="line">: This is the definition of the first term.</span><br><span class="line"></span><br><span class="line">Second Term</span><br><span class="line">: This is one definition of the second term.</span><br><span class="line">: This is another definition of the second term.</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dl</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">dt</span>&gt;</span></span>First Term<span class="language-xml"><span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">dd</span>&gt;</span></span>This is the definition of the first term.<span class="language-xml"><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">dt</span>&gt;</span></span>Second Term<span class="language-xml"><span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">dd</span>&gt;</span></span>This is one definition of the second term. <span class="language-xml"><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">dd</span>&gt;</span></span>This is another definition of the second term.<span class="language-xml"><span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>删除线 strikethrough</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">~~The world is flat.~~</span><br></pre></td></tr></table></figure>
</li>
<li><p>任务列表 task list</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> [x]</span><br><span class="line"><span class="bullet">-</span> [ ]</span><br></pre></td></tr></table></figure>
</li>
<li><p>表情 emoji</p>
<p><a target="_blank" rel="noopener" href="https://emojipedia.org/">Emojipedia</a></p>
<p><a target="_blank" rel="noopener" href="https://gist.github.com/rxaviers/7360908">list of emoji shortcodes</a></p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">That is so funny! :joy:</span><br></pre></td></tr></table></figure>
</li>
<li><p>高亮 highlight</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I need to highlight these ==very important words==.</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mark</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">mark</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>下标 subscript</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">H~2~0</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">sub</span>&gt;</span></span>2<span class="language-xml"><span class="tag">&lt;/<span class="name">sub</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>上标 superscript</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X^2^</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">sup</span>&gt;</span></span>2<span class="language-xml"><span class="tag">&lt;/<span class="name">sup</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ol>
<p>diable automatic URL linking</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="code">`http://www.example.com`</span></span><br></pre></td></tr></table></figure>

<h2 id="Hacks"><a href="#Hacks" class="headerlink" title="Hacks"></a>Hacks</h2><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="section"># 下划线 underline</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">ins</span>&gt;</span></span><span class="language-xml"><span class="tag">&lt;/<span class="name">ins</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># indent(Tab)</span></span><br><span class="line">&amp;nbsp; non-breaking space</span><br><span class="line"></span><br><span class="line"><span class="section"># center</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;text-align:center&quot;</span>&gt;</span></span>Center this text<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># color</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color:blue&quot;</span>&gt;</span></span>Make this text blue.<span class="language-xml"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># comment</span></span><br><span class="line">[<span class="symbol">This is a comment that will be hidden.</span>]: <span class="link">#</span></span><br><span class="line"></span><br><span class="line"><span class="section"># 告诫 admonitions</span></span><br><span class="line"><span class="quote">&gt; :warning: <span class="strong">**Warning:**</span> Do not push the big red button.</span></span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; :memo: <span class="strong">**Note:**</span> Sunrises are beautiful.</span></span><br><span class="line"></span><br><span class="line"><span class="quote">&gt; :bulb: <span class="strong">**Tip:**</span> Remember to appreciate the little things in life.</span></span><br><span class="line"></span><br><span class="line"><span class="section"># image size</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;image.png&quot;</span> <span class="attr">width</span>=<span class="string">&quot;200&quot;</span> <span class="attr">height</span>=<span class="string">&quot;100&quot;</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="section"># 图像说明 image captions</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">figure</span>&gt;</span></span></span><br><span class="line"><span class="code">    &lt;img src=&quot;/assets/images/albuquerque.jpg&quot;</span></span><br><span class="line"><span class="code">         alt=&quot;Albuquerque, New Mexico&quot;&gt;</span></span><br><span class="line"><span class="code">    &lt;figcaption&gt;A single track trail outside of Albuquerque, New Mexico.&lt;/figcaption&gt;</span></span><br><span class="line"><span class="code">&lt;/figure&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">![<span class="string">Albuquerque, New Mexico</span>](<span class="link">/assets/images/albuquerque.jpg</span>)</span><br><span class="line"><span class="emphasis">*A single track trail outside of Albuquerque, New Mexico.*</span></span><br><span class="line"></span><br><span class="line"><span class="section"># link target</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://www.markdownguide.org&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span></span>Learn Markdown!<span class="language-xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section"># symbols</span></span><br><span class="line">Copyright (©) — &amp;copy;</span><br><span class="line">Registered trademark (®) — &amp;reg;</span><br><span class="line">Trademark (™) — &amp;trade;</span><br><span class="line">Euro (€) — &amp;euro;</span><br><span class="line">Left arrow (←) — &amp;larr;</span><br><span class="line">Up arrow (↑) — &amp;uarr;</span><br><span class="line">Right arrow (→) — &amp;rarr;</span><br><span class="line">Down arrow (↓) — &amp;darr;</span><br><span class="line">Degree (°) — &amp;#176;</span><br><span class="line">Pi (π) — &amp;#960;</span><br><span class="line"></span><br><span class="line"><span class="section"># table 里的元素</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span></span><br><span class="line">list</span><br><span class="line"></span><br><span class="line"><span class="section"># table of contents</span></span><br><span class="line"><span class="bullet">-</span> [<span class="string">Underline</span>](<span class="link">#underline</span>)</span><br><span class="line"><span class="bullet">-</span> [<span class="string">Indent</span>](<span class="link">#indent</span>)</span><br><span class="line"><span class="bullet">-</span> [<span class="string">Center</span>](<span class="link">#center</span>)</span><br><span class="line"><span class="bullet">-</span> [<span class="string">Color</span>](<span class="link">#color</span>)</span><br><span class="line"></span><br><span class="line"><span class="section"># video</span></span><br><span class="line">YouTube automatically generates an image for every video (https://img.youtube.com/vi/YOUTUBE-ID/0.jpg), so we can use that and link the image to the video on YouTube. After we replace the image alt text and add the ID of the video, our example looks like this:</span><br><span class="line">[<span class="string">![Less Than Jake — Scott Farcas Takes It On The Chin</span>](<span class="link">https://img.youtube.com/vi/PYCxct2e0zI/0.jpg</span>)](<span class="link">https://www.youtube.com/watch?v=PYCxct2e0zI</span>)</span><br></pre></td></tr></table></figure>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2022-03-18T15:34:00.000Z" title="3/18/2022, 11:34:00 PM">2022-03-18</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-06-24T07:36:26.088Z" title="6/24/2024, 3:36:26 PM">2024-06-24</time></span><span class="level-item">4 minutes read (About 667 words)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2022/03/18/draft/Redis/">Redis</a></p><div class="content"><p>release: latest</p>
<h1 id="data-structure-sds-in-redis"><a href="#data-structure-sds-in-redis" class="headerlink" title="data structure sds in redis"></a>data structure sds in redis</h1><p>sds: simple dynamic string. 类型 sds 的声明为</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="type">char</span>*sds;</span><br></pre></td></tr></table></figure>

<p>为 sds 申请动态内存的时候，申请了一块连续内存，该内存头部包含了 sds 的头部信息，并且维护该头部信息，源码里称为 sds_hdr_var， sds的 header variable</p>
<p>最新版本的 redis 一共实现了五种相似的 sds 结构体，分别为 sdshdr5（不建议使用）， sdshdr8， sdshdr16， sdshdr32， sdshdr64，以 sdshdr5 和 sdshdr8 为例</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr5</span> &#123;</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags; <span class="comment">/* 3 lsb of type, and 5 msb of string length */</span></span><br><span class="line">    <span class="type">char</span> buf[];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">attribute__</span> ((__<span class="title">packed__</span>)) <span class="title">sdshdr8</span> &#123;</span></span><br><span class="line">    <span class="type">uint8_t</span> len; <span class="comment">/* used */</span></span><br><span class="line">    <span class="type">uint8_t</span> alloc; <span class="comment">/* excluding the header and null terminator */</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> flags; <span class="comment">/* 3 lsb of type, 5 unused bits */</span></span><br><span class="line">    <span class="type">char</span> buf[];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol>
<li>struct 声明中使用了 GNU C 编译器的结构体注释，放弃编译器对字节对齐的优化；</li>
<li>变量 flags 中 3 lsb (低三位) 表示了该结构体变量的类型，一共五种，所以只需要低三位；</li>
<li>变量 len 为该 string 已经使用的字符串长度，不包含 C 风格字符串的 ‘\000’；</li>
<li>变量 alloc 为该 string 分配的字符串长度，包含了 C 风格字符串中的 ‘\000’，</li>
<li>变量 buf 为空，实际上代表结构体 char *sds 的位置，与头部信息相连。</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_TYPE_5  0</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_TYPE_8  1</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_TYPE_16 2</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_TYPE_32 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_TYPE_64 4</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_TYPE_MASK 7</span></span><br></pre></td></tr></table></figure>

<p>宏变量，方便进行位操作</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_TYPE_BITS 3</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_TYPE_5_LEN(f) ((f)&gt;&gt;SDS_TYPE_BITS)</span></span><br></pre></td></tr></table></figure>

<p>宏变量，低三位，移位可以获取 type</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_HDR_VAR(T,s) struct sdshdr##T *sh = (void*)((s)-(sizeof(struct sdshdr##T)));</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SDS_HDR(T,s) ((struct sdshdr##T *)((s)-(sizeof(struct sdshdr##T))))</span></span><br></pre></td></tr></table></figure>

<p>第一个宏函数，声明一个指针 sh，指向 sdshdr##T 类型，sds 变量 s 的指针，该指针指向头部信息</p>
<p>第二个宏函数，同第一个，但不显示声明指针，只是获取地址</p>
<p>通过位操作位偏移操作，可以非常方便的获取 sds 变量的头部信息</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">char</span> flags = s[<span class="number">-1</span>];</span><br><span class="line"><span class="keyword">switch</span>(flags&amp;SDS_TYPE_MASK)</span><br></pre></td></tr></table></figure>



<h2 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h2><p>保存了 string 信息，二进制安全，同时使用了大量位操作，加快运算。</p>
<p>sds 中保存的实际上是 C 风格字符串，可以使用 C 标准库接口</p>
<h1 id="sds-模块依赖"><a href="#sds-模块依赖" class="headerlink" title="sds 模块依赖"></a>sds 模块依赖</h1><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">sds.o: sds.c sds.h sdsalloc.h zmalloc.h \</span></span><br><span class="line"> ../deps/jemalloc/<span class="keyword">include</span>/jemalloc/jemalloc.h</span><br></pre></td></tr></table></figure>

<p>依赖为 redis 实现的 zmalloc，zmalloc 是 redis 为 jemalloc 封装的自己内部模块的申请动态内存模块，jemalloc 为优秀的用于高并发用于替代 malloc 的开源库</p>
<p>sdsalloc.h 为 sds 模块与 zmalloc 模块的定义接口文件</p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous"><a href="/page/2/">Previous</a></div><div class="pagination-next"><a href="/page/4/">Next</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link is-current" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/./img/avatar.svg" alt="Helianthus"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">Helianthus</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Nanjing, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives"><p class="title">31</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags"><p class="title">5</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/love1angel" target="_blank" rel="noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/love1angel"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="X" href="https://twitter.com/helianthus_xp"><i class="fab fa-x"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">Links</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://leetcode.cn/u/peng-xie" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">leetcode</span></span><span class="level-right"><span class="level-item tag">leetcode.cn</span></span></a></li><li><a class="level is-mobile" href="https://stackoverflow.com/users/11366751/helianthus" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">stackoverflow</span></span><span class="level-right"><span class="level-item tag">stackoverflow.com</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/embedded/"><span class="level-start"><span class="level-item">embedded</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/ethernet/"><span class="level-start"><span class="level-item">ethernet</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/ethernet/some-ip/"><span class="level-start"><span class="level-item">some/ip</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/gdb/"><span class="level-start"><span class="level-item">gdb</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/languages/"><span class="level-start"><span class="level-item">languages</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/languages/cpp/"><span class="level-start"><span class="level-item">cpp</span></span><span class="level-end"><span class="level-item tag">9</span></span></a><ul><li><a class="level is-mobile" href="/categories/languages/cpp/optimize/"><span class="level-start"><span class="level-item">optimize</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/languages/cpp/realize/"><span class="level-start"><span class="level-item">realize</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/languages/cpp/tools/"><span class="level-start"><span class="level-item">tools</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/linux/"><span class="level-start"><span class="level-item">linux</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/terminology/"><span class="level-start"><span class="level-item">terminology</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/tools/"><span class="level-start"><span class="level-item">tools</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-04T07:09:25.000Z">2024-07-04</time></p><p class="title"><a href="/2024/07/04/bazel/">bazel</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-02T02:43:45.000Z">2024-07-02</time></p><p class="title"><a href="/2024/07/02/embedded/yocto/">yocto</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-02T02:05:53.000Z">2024-07-02</time></p><p class="title"><a href="/2024/07/02/embedded/environment/">嵌入式环境</a></p><p class="categories"><a href="/categories/embedded/">embedded</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-24T14:30:42.000Z">2024-06-24</time></p><p class="title"><a href="/2024/06/24/terminology/adas/">adas</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-06-06T05:47:50.000Z">2024-06-06</time></p><p class="title"><a href="/2024/06/06/languages/cpp/realize/mangle/">mangle</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">July 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">June 2024</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">May 2024</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">April 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/08/"><span class="level-start"><span class="level-item">August 2022</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/05/"><span class="level-start"><span class="level-item">May 2022</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/04/"><span class="level-start"><span class="level-item">April 2022</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2022/03/"><span class="level-start"><span class="level-item">March 2022</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/cpp/"><span class="tag">cpp</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/done/"><span class="tag">done</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/llvm/"><span class="tag">llvm</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/midware/"><span class="tag">midware</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/./img/avatar.svg" alt="Helianthus&#039;s Blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 Helianthus</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">Made with 💖</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>